{% extends "base.html" %}

{% block title %}ììœ ê²Œì‹œíŒ - JBJ Community{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for(request, 'static', path='/css/freeboardList.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- ê²Œì‹œíŒ í—¤ë” -->
    <div class="board-header">
        <h1>ììœ ê²Œì‹œíŒ</h1>
        <p class="board-description">ììœ ë¡­ê²Œ ì†Œí†µí•˜ëŠ” ì»¤ë®¤ë‹ˆí‹° ê³µê°„ì…ë‹ˆë‹¤</p>
    </div>

    <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
    <div class="board-controls">
        <form method="get" action="{{ url_for(request, 'board_list') }}" class="search-box">
            <select name="search_type" class="search-type">
                <option value="title" {% if search_type == 'title' %}selected{% endif %}>ì œëª©</option>
                <option value="content" {% if search_type == 'content' %}selected{% endif %}>ë‚´ìš©</option>
                <option value="author" {% if search_type == 'author' %}selected{% endif %}>ì‘ì„±ì</option>
                <option value="all" {% if search_type == 'all' %}selected{% endif %}>ì „ì²´</option>
            </select>
            <input type="text" name="keyword" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ keyword }}">
            <input type="hidden" name="sort_by" value="{{ sort_by }}">
            <button type="submit" class="btn-search">ê²€ìƒ‰</button>
        </form>

        <div class="sort-box">
            <select id="sortSelect" class="sort-select" onchange="changeSort(this.value)">
                <option value="recent" {% if sort_by == 'recent' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
                <option value="views" {% if sort_by == 'views' %}selected{% endif %}>ì¡°íšŒìˆ˜ìˆœ</option>
                <option value="likes" {% if sort_by == 'likes' %}selected{% endif %}>ì¢‹ì•„ìš”ìˆœ</option>
            </select>
        </div>

        {% if current_user %}
        <a href="{{ url_for(request, 'board_write_page') }}" class="btn-write">ê¸€ì“°ê¸°</a>
        {% endif %}
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
    <div class="board-list">
        {% if board_list %}
            {% for item in board_list %}
            <div class="board-item" onclick="location.href='{{ url_for(request, 'board_detail', board_no=item.board.board_no) }}'">
                {% if item.thumbnail %}
                    <img src="{{ item.thumbnail }}" alt="ì¸ë„¤ì¼" class="board-thumbnail">
                {% else %}
                    <div class="board-thumbnail no-image">ğŸ“„</div>
                {% endif %}
                
                <div class="board-content">
                    <h3 class="board-title">{{ item.board.board_title }}</h3>
                    
                    <div class="board-meta">
                        <div class="board-author">
                            {% if item.board.author.profile_img %}
                                <img src="/uploads{{ item.board.author.profile_img }}" alt="í”„ë¡œí•„" class="author-profile">
                            {% else %}
                                <span>ğŸ‘¤</span>
                            {% endif %}
                            <span>{{ item.board.author.member_nickname }}</span>
                        </div>
                        <span>Â·</span>
                        <span>{{ item.board.b_create_date.strftime('%Y.%m.%d') }}</span>
                    </div>

                    <div class="board-stats">
                        <div class="stat-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <span>{{ item.board.board_count }}</span>
                        </div>
                        <div class="stat-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                            <span>{{ item.like_count }}</span>
                        </div>
                        <div class="stat-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                            <span>{{ item.comment_count }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-list">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        {% endif %}
    </div>

    <!-- í˜ì´ì§• -->
    {% if total_pages > 1 %}
    <div class="pagination">
        <!-- ì´ì „ ë²„íŠ¼ -->
        {% if page > 1 %}
            <a href="{{ url_for(request, 'board_list') }}?page={{ page - 1 }}&limit={{ limit }}&keyword={{ keyword }}&search_type={{ search_type }}&sort_by={{ sort_by }}" class="page-btn">â€¹</a>
        {% else %}
            <button class="page-btn" disabled>â€¹</button>
        {% endif %}

        <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
        {% for page_num in page_numbers %}
            <a href="{{ url_for(request, 'board_list') }}?page={{ page_num }}&limit={{ limit }}&keyword={{ keyword }}&search_type={{ search_type }}&sort_by={{ sort_by }}" 
               class="page-btn {% if page_num == page %}active{% endif %}">
                {{ page_num }}
            </a>
        {% endfor %}

        <!-- ë‹¤ìŒ ë²„íŠ¼ -->
        {% if page < total_pages %}
            <a href="{{ url_for(request, 'board_list') }}?page={{ page + 1 }}&limit={{ limit }}&keyword={{ keyword }}&search_type={{ search_type }}&sort_by={{ sort_by }}" class="page-btn">â€º</a>
        {% else %}
            <button class="page-btn" disabled>â€º</button>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// ì •ë ¬ ë³€ê²½
function changeSort(sortBy) {
    const url = new URL(window.location.href);
    url.searchParams.set('sort_by', sortBy);
    url.searchParams.set('page', '1'); // ì •ë ¬ ë³€ê²½ ì‹œ 1í˜ì´ì§€ë¡œ
    window.location.href = url.toString();
}
</script>
{% endblock %}